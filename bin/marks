#!/bin/sh
# TODO
# encrypt/decrypt bookmarks with gpg

bookmarks_file="$HOME/stuff/sync/BACKUPbookmarks"
temp_file="/tmp/temp_bookmarks"


help() {
    cat << EOF
Usage:
    marks: choose bookmark to open
    marks add: add bookmark
    marks help: show this screen
EOF
}


show_bookmarks() {
    dmenu -i -l 20 < "$bookmarks_file" | cut -d ';' -f1
}


open() {
    choice=$(show_bookmarks)
    [ -z "$choice" ] && exit
    printf "%s" "$choice" | xclip
    setsid -f "$BROWSER" "$choice" 1> /dev/null 2>&1
}


add() {
    if [ -z "$1" ]; then
        printf "%s\n" "$(xclip -o)" >> "$bookmarks_file"
    else
        printf "%s\n" "$*" >> "$bookmarks_file"
    fi
}


change() {
    choice=$(show_bookmarks)
    new=$(printf "Editing %s\n" "$choice" | dmenu -l 2 -p "Edit: ")
    add "$new"
    sed "\~$choice~d" "$bookmarks_file" > "$temp_file"
    mv "$temp_file" "$bookmarks_file"
}


case $1 in
    add) shift ; add "$*" ;;
    edit) "$EDITOR" "$bookmarks_file" ;;
    change) shift ; change "$1" ;;
    -h| --help) help ;;
    *) open ;;
esac
