#!/bin/bash
#run script as root


#TODO
#every instance of "$HOME" will need to be changed to /home/"$username"

#since this script will be ran as root, you will need
#to change the permission of the git cloned folder, AND you will have to copy the 
#location of the folder to the new users home directory, this can be added to 
#the rename git repo directory part and made into a function 
#chown -R "$username":wheel /home/"$username"/arch I THINK

#okay make sure you INSTALL and SET zsh first
#useradd -m -G mpd,audio,wheel -s /bin/zsh $username
#echo "$username:$password" | chpasswd

#Check for internet connection
[ "$(ping -c 1 9.9.9.9)" ] && echo "Success!" || echo "Please check your internet connection"


#Rename git repo directory
mv "$HOME"/arch "$HOME"/archconfig


#Add necessary directories
mkdir "$HOME"/downloadmusic "$HOME"/linuxbook "$HOME"/memes "$HOME"/memes/website "$HOME"/music "$HOME"/storagedrive "$HOME"/scripts "$HOME"/walls "$HOME"/archwikidocs "$HOME"/gitwebsite "$HOME"/.newsboat "$HOME"/alacritty "$HOME"/dunst "$HOME"/i3 "$HOME"/mpd "$HOME"/ncmpcpp "$HOME"/nvim "$HOME"/picom "$HOME"/polybar "$HOME"/ranger "$HOME"/sxhkd "$HOME"/youtube-dl


#Check if packages are installed, install them if not
installpackages() {
while IFS= read -r line; do
    [ "$(pacman -Qqe | grep "$line")" ] && echo "$line already installed" || sudo -u "$username" pacman --noconfirm --needed -S "$line"
done < "$1"
}


#Copy the config files from the git directory to their proper locations
placeconfigs() {
while IFS=, read -r file location; do
    cp -r "$HOME"/archconfig/"$file" "$HOME"/"$location"
done < "$1"
}


#Create the user account, add them to the necessary groups, and
#set a password.
usernameandpassword() {
    echo "What do you want your username to be?" ; read -r username
    echo "What do you want your password to be?" ; read -r password
    useradd -m -G mpd,audio,wheel -s /bin/zsh "$username"
    echo "$username":"$password" | chpasswd
}


#This command will generate skeleton config for ranger
ranger --copy-config=all


usernameandpassword || exit 1
installpackages packages.txt || exit 1
placeconfigs configlocations.csv || exit 1


#Change default shell to zsh
chsh -s /usr/bin/zsh
